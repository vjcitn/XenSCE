
#' build a XenSCE instance for GBM demo data from TENx
#' @import SingleCellExperiment ParquetDataFrame S4Vectors
#' @importFrom utils read.csv read.delim untar
#' @importFrom SummarizedExperiment rowData<- colData<-
#' @rawNamespace import(Matrix, except=c(unname, expand))
#' @note This can take some time to run, especially if no resources
#' have been cached yet.
#' @export
build_demo = function() {
 paths = cache_assets()
 mat.tgzpath = paths[["cell_feature_matrix.tar.gz"]]
 td = tempdir()
 untar(mat.tgzpath, exdir=td)
 newp = dir(file.path(td, "cell_feature_matrix"), full=TRUE)
 matpa = grep("mtx", newp, value=TRUE)
 coumat = Matrix::readMM(matpa)
 barpa = grep("barco", newp, value=TRUE)
 bardf = read.delim(barpa, sep="\t", h=FALSE) # V1 needed
 feapa = grep("features", newp, value=TRUE)
 feadf = read.delim(feapa, sep="\t", h=FALSE) # V1 needed
 rownames(coumat) = feadf$V1
 colnames(coumat) = bardf$V1
 colnames(feadf) = c("ensid", "symbol", "type")
 alist = SimpleList(counts=coumat)
 sce = SingleCellExperiment(assays=alist)
 cellmeta = read.csv(paths[["cells.csv.gz"]])
 colData(sce) = DataFrame(cellmeta)
 rowData(sce) = DataFrame(feadf)
 tppath = paths[["transcripts.parquet"]]
 tx = ParquetDataFrame(tppath)
 cbpath = paths[["cell_boundaries.parquet"]]
 cb = ParquetDataFrame(cbpath)
 nbpath = paths[["nucleus_boundaries.parquet"]]
 nb = ParquetDataFrame(nbpath)
 new("XenSCE", sce, transcripts=tx, cellbounds=cb,
    nucbounds=nb)
}
 
 

